name: Notifica√ß√£o no Discord

on:
  push:
    branches:
      - master
    paths:
      - 'docs/**'
      - '**/*.md'
  pull_request:
    branches:
      - master
    paths:
      - 'docs/**'
      - '**/*.md'
    types:
      - opened
      - synchronize
      - reopened
      - closed

jobs:
  changelog-discord:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout do c√≥digo
        uses: actions/checkout@v4

      - name: Enviar atualia√ß√µes para o Discord
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          AUTOR="Yampi"

          if [ "${{ github.event_name }}" = "pull_request" ]; then
            TITLE="${{ github.event.pull_request.title }}"
            BODY="${{ github.event.pull_request.body }}"

            if [ -z "$BODY" ]; then
              BODY="(sem descri√ß√£o)"
            fi

            if [ "${{ github.event.pull_request.merged }}" = "true" ]; then
              STATUS="Atualiza√ß√£o fresquinha!"
              curl -H "Content-Type: application/json" \
                   -X POST \
                   -d "{\"content\": \"üìù ${STATUS} por **${AUTOR}**\n**${TITLE}**\n${BODY}\"}" \
                   $DISCORD_WEBHOOK
            fi

          elif [ "${{ github.event_name }}" = "push" ]; then
            COMMITS=$(git log --pretty=format:'- "**Yampi**: \"%s\""' ${{ github.event.before }}..${{ github.sha }} | head -n 10)

            if [ -n "$COMMITS" ]; then
              curl -H "Content-Type: application/json" \
                   -X POST \
                   -d "{\"content\": \"üìù Atualiza√ß√µes na documenta√ß√£o por **${AUTOR}**:\n${COMMITS}\"}" \
                   $DISCORD_WEBHOOK
            fi
          fi
