on:
  push:
    branches:
      - master 
    paths:
      - 'docs/**'
      - '**/*.md'

jobs:
  notify-discord:
    runs-on: ubuntu-latest
    steps:
      - name: Verificar Ãºltimas alteraÃ§Ãµes
        uses: actions/checkout@v4

- name: Enviar notificaÃ§Ã£o para o Discord
  env:
    DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
  run: |
    if [ "${{ github.event_name }}" = "pull_request" ]; then
      TITLE="${{ github.event.pull_request.title }}"
      BODY="${{ github.event.pull_request.body }}"
      AUTHOR="${{ github.event.pull_request.user.login }}"
      URL="${{ github.event.pull_request.html_url }}"
      if [ "${{ github.event.pull_request.merged }}" = "true" ]; then
        STATUS="MERGEADO âœ…"
      else
        STATUS="Atualizado ðŸ”„"
      fi

      curl -H "Content-Type: application/json" \
           -X POST \
           -d "{\"content\": \"ðŸ“˜ Pull Request ${STATUS} por **${AUTHOR}**:\n**TÃ­tulo:** _${TITLE}_\n**DescriÃ§Ã£o:** ${BODY}\nðŸ”— ${URL}\"}" \
           $DISCORD_WEBHOOK
    else
      COMMITS=$(git log --pretty=format:'- **%an**: _\"%s\"_' ${{ github.event.before }}..${{ github.sha }})
      if [ -n "$COMMITS" ]; then
        curl -H "Content-Type: application/json" \
             -X POST \
             -d "{\"content\": \"ðŸ“˜ AtualizaÃ§Ãµes na documentaÃ§Ã£o:\n$COMMITS\"}" \
             $DISCORD_WEBHOOK
      fi
    fi
